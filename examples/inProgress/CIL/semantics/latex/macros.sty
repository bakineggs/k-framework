\usepackage{amsmath}
\usepackage{amssymb}
  \newcommand\hmmax{0} % default 3
   \newcommand\bmmax{0} % default 4
\usepackage[polutonikogreek,english]{babel}
\usepackage[T1]{fontenc}
\usepackage{ae,aecompl}
\usepackage{xspace}
%\usepackage[numbers]{natbib}
\bibliographystyle{plainnat}
\usepackage{enumerate}
\usepackage{fancyvrb}
\usepackage{mathrsfs}
\usepackage{arydshln}
\usepackage{amsthm}
\usepackage[factor=700]{microtype}
\usepackage{comment}
\usepackage{qtree,eepic}
\usepackage{synttree}
\usepackage{xspace}
\usepackage{wrapfig}
\usepackage{etex}
\usepackage{tikz}
\usetikzlibrary{arrows}
\usetikzlibrary{shapes.misc}
\usetikzlibrary{shapes.arrows}
\usetikzlibrary{shapes.symbols}
\usetikzlibrary{positioning}
\usetikzlibrary{calc}
\usetikzlibrary{decorations.pathmorphing}
\usetikzlibrary{matrix}
\usepackage{ifthen}

\usepackage{ifthen}
\usepackage{type1cm} 
\usepackage{calc}
%\usepackage{tkz-graph}

\usepackage{mathtools}

\usepackage{listings}
 
 
\newcommand{\K}{\ensuremath{\mathbb{K}}\xspace}


\usepackage{ucs} % for unicode characters (just for \Rosu and \Serbanuta)
\newcommand{\sh}{\unichar{0537}}
\newcommand{\Sh}{\unichar{0536}}
\newcommand{\tz}{\unichar{0539}}
\newcommand{\Tz}{\unichar{0538}}
\PrerenderUnicode{\sh}
\PrerenderUnicode{\Sh}
\PrerenderUnicode{\tz}
\PrerenderUnicode{\Tz}
\newcommand{\Serbanuta}{{\Sh}erb{\u a}nu{\tz}{\u a}}
\newcommand{\Rosu}{Ro{\sh}u}
\newcommand{\Iasi}{Ia{\sh}i}

\newcommand{\mycomment}[1]{}
\newcommand{\ideaMea}[1]{}

%\newenvironment{proof}{{\it Proof. }}{\hfill$\Box$}

\parfillskip=0pt plus .75\textwidth
\widowpenalty=10000
\clubpenalty=10000
\raggedbottom


\newcommand{\Underline}[1]{{\it #1}}

\newcommand{\hsp}{\hspace*{2ex}}
\newcommand{\vsp}{\vspace*{2ex}}

\newcommand{\heading}[1]{\textbf{#1}}

\newcommand{\asfsdf}{{\sc Asf}+{\sc Sdf}\xspace}


\newcommand{\atMost}[1]{\mbox{\tiny$\leq$}#1}
\newcommand{\Ra}{\Rightarrow}
\newcommand{\lra}{\longrightarrow}
\newcommand{\co}{\,\colon\;}
\newcommand{\Rra}{\Rrightarrow}

\newcommand{\denote}[1]{[\![{#1}]\!]}

\newtheorem{hw-exercise}{Homework Exercise}
\newtheorem{exercise}{Exercise}
\newtheorem{claim}{Conjecture}

%\newcommand{\comment}[1]{}

%\newcommand{\K}[1]{\begin{equation}\parbox{.85\textwidth}{$\displaystyle{#1}$}\end{equation}}

\newcommand{\myvector}{\overrightarrow}


\newcommand{\BigStep}[3]{{\langle{#1},{#2}\rangle \Downarrow \langle{#3}\rangle}}
\newcommand{\BigStepFour}[4]{{\langle{#1},{#2}\rangle \Downarrow \langle{#3},{#4}\rangle}}
\newcommand{\BigStepFive}[5]{{\langle{#1},{#2}\rangle \Downarrow \langle{#3},{#4},{#5}\rangle}}
\newcommand{\BigStepPair}[2]{{\langle{#1}\rangle \Downarrow \langle{#2}\rangle}}
\newcommand{\SmallStep}[4]{{\langle{#1},{#2}\rangle \rightarrow \langle{#3},{#4}\rangle}}
\newcommand{\SmallStepTriple}[3]{{\langle{#1},{#2}\rangle \rightarrow \langle{#3}\rangle}}
\newcommand{\SmallStepSix}[6]{{\langle{#1},{#2},{#3}\rangle \rightarrow \langle{#4},{#5},{#6}\rangle}}

\newcommand{\CHALLENGE}{\textsc{Agent}}
%\newcommand{\CHALLENGE}{\textsc{Challenge}}
\newcommand{\imp}{\textsc{Imp}}
\newcommand{\imppp}{{\imp\!+\!\!+}}
\newcommand{\IMP}{\imp}
\newcommand{\IMPPP}{\imppp}

\newcommand{\Id}{{\it Id}}
\newcommand{\Real}{{\it Real}}
\newcommand{\Exp}{{\it Exp}}
\newcommand{\VarId}{{\it VarId}}
\newcommand{\sInt}{{\it Int}}

\newcommand{\Sequals}{=}
\newcommand{\Soutput}{{\sf output}}
\newcommand{\Sref}{{\sf ref}}
\newcommand{\SrandomBool}{{\sf randomBool}}
\newcommand{\Shole}{{\sf hole}}
\newcommand{\Saspect}{{\sf aspect}}

\newcommand{\Store}{{\it Store}}
\newcommand{\Stmt}{{\it Stmt}}
\newcommand{\AExp}{{\it AExp}}
\newcommand{\BExp}{{\it BExp}}
\newcommand{\Pgm}{{\it Pgm}}
\newcommand{\AVal}{{\it AVal}}
\newcommand{\BVal}{{\it BVal}}
\newcommand{\SVal}{{\it SVal}}
\newcommand{\bool}{{\it bool}}
\newcommand{\lmid}{\\ & \mid &} 
\newcommand{\Bigstep}{{\it BigStep}}
\newcommand{\Smallstep}{{\it SmallStep}}
\newcommand{\MSOS}{{\it MSOS}}
\newcommand{\sMSOS}{{\it MSOS}}
\newcommand{\CHAM}{{\it CHAM}}
\newcommand{\sCHAM}{{\it CHAM}}
\newcommand{\Reduction}{{\it CxtRed}}
\newcommand{\sStore}{{\it Store}}
\newcommand{\sBigstep}{{\it BigStep}}
\newcommand{\sSmallstep}{{\it SmallStep}}
\newcommand{\sReduction}{{\it CxtRed}}
\newcommand{\sK}{{\scriptstyle K}}
\newcommand{\ra}{\rightarrow}
\newcommand{\la}{\leftarrow}
\newcommand{\diez}[1]{#1}
\newcommand{\pra}{\stackrel{\circ}{\rightarrow}}
\newcommand{\cif}{\mathrel{\textbf{if}}}



\newcommand{\Sfun}{{\sf fun}}
\newcommand{\Slet}{{\sf let}}
\newcommand{\Sletrec}{{\sf letrec}}
\newcommand{\Sin}{{\sf in}}
\newcommand{\Slist}{{\sf list}}
\newcommand{\Scar}{{\sf car}}
\newcommand{\Scdr}{{\sf cdr}}
\newcommand{\Snull}{{\sf null?}}
\newcommand{\Scons}{{\sf cons}}
\newcommand{\Sval}{{\sf val}}
\newcommand{\Sname}{{\sf name}}
\newcommand{\Sneed}{{\sf need}}

\newcommand{\Ssort}{{\sf sort}}

\newcommand{\Sra}{\mapsto}

\newcommand{\SrandBool}{{\sf randBool}}
\newcommand{\Spp}{\texttt{++}}
\newcommand{\Sreturn}{{\sf return}}
\newcommand{\Scallcc}{{\sf callcc}}
\newcommand{\Serror}{{\sf error}}
\newcommand{\Sspawn}{{\sf spawn}}
\newcommand{\Srv}{{\sf rv}}
\newcommand{\Sacquire}{{\sf acquire}}
\newcommand{\Srelease}{{\sf release}}
\newcommand{\Squote}{{\sf quote}}
\newcommand{\Sunquote}{{\sf unquote}}
\newcommand{\Seval}{{\sf eval}}
\newcommand{\code}{{\it code}}
\newcommand{\Sdone}{{\sf done}}

\newcommand{\eqns}{{\it eqns}}
\newcommand{\Eqn}{{\it Eqn}}
\newcommand{\Eqns}{{\it Eqns}}
\newcommand{\nextType}{{\it nextType}}
\newcommand{\mylet}{{\it let}}
\newcommand{\vars}{{\it vars}}


\newcommand{\C}{{\it Cxt}}
\newcommand{\A}{{\it AExp}}
\newcommand{\B}{{\it BExp}}
\newcommand{\Const}{{\it Const}}
\newcommand{\St}{{\it Stmt}}
\newcommand{\Type}{{\it Type}}
\newcommand{\TypeVar}{{\it TypeVar}}
\newcommand{\TConst}{{\it TypeConst}}
\newcommand{\TVar}{{\it TypeVar}}
\newcommand{\TExp}{{\it TypeExp}}
\newcommand{\texp}{{\it texp}}
\newcommand{\type}{{\it type}}
\newcommand{\typeOf}{{\it typeOf}}
\newcommand{\Free}{{\it Free}}

\newcommand{\Binding}{{\it Binding}}
\newcommand{\ExpList}{{\it ExpList}}
\newcommand{\Params}{{\it Params}}
\newcommand{\ParamsSeq}{{\it ParamsSeq}}
\newcommand{\ParamPassStyle}{{\it ParamPassStyle}}
\newcommand{\mkFrozenVal}{{\it mkFrozenVal}}
\newcommand{\mkUnfreezeVal}{{\it mkUnfreezeVal}}
\newcommand{\kunit}{{\it unit}}


\renewcommand{\c}[1]{#1}

%\newcommand{\Var}{{\it Var}}
\newcommand{\Var}{{\it Name}}
\newcommand{\Val}{{\it Val}}
\newcommand{\Int}{{\it Int}}
\newcommand{\Nat}{{\it Nat}}
\newcommand{\Float}{{\it Float}}
\newcommand{\Bool}{{\it Bool}}
\newcommand{\intg}{{\it int}}
\newcommand{\float}{{\it float}}
\newcommand{\KResult}{{\it KResult}}
\newcommand{\KHybridLabel}{{\it KHybridLabel}}
\newcommand{\KResultLabel}{{\it KResultLabel}}
\newcommand{\KProper}{{\it KProper}}
\newcommand{\KLabel}{{\it KLabel}}
\newcommand{\KConstant}{{\it KConstant}}
\newcommand{\seqstrict}{{\it seqstrict}}
\newcommand{\hybrid}{{\it hybrid}}
\newcommand{\strict}{{\it strict}}
\newcommand{\results}{{\it results}}
\newcommand{\extends}{{\it extends}}

\newcommand{\writeTo}{{\it writeTo}}
\newcommand{\writeToAndKeep}[1]{\mathrel{\it writeTo}{#1}\mathrel{\it andKeep}}
\newcommand{\discard}{{\it discard}}

%\newcommand{\KResult}{{\it KResult}}
\newcommand{\Config}{{\it Config}}
\newcommand{\Cell}{{\it Cell}}
\newcommand{\ConfigItem}{{\it ConfigItem}}
\newcommand{\ThreadItem}{{\it ThreadItem}}
\newcommand{\state}{{\it state}}
\newcommand{\sState}{{\it State}}
\newcommand{\koutput}{{\it output}}
\newcommand{\Out}{{\it Out}}
\newcommand{\env}{{\sf env}}
\newcommand{\Env}{{\it Env}}
%\newcommand{\Store}{{\it Store}}
\newcommand{\Loc}{{\it Loc}}
\newcommand{\nextLoc}{{\sf nextLoc}}
\newcommand{\closure}{{\it closure}}
\newcommand{\klist}{{\it list}}
\newcommand{\restoreIT}{{\it restore}}
\newcommand{\kaspect}{{\sf aspect}}
\newcommand{\kthread}{{\sf thread}}
\newcommand{\kholds}{{\sf holds}}
\newcommand{\kbusy}{{\sf busy}}
\newcommand{\newThread}{{\it newThread}}
\newcommand{\kagent}{{\sf agent}}
\newcommand{\kmessage}{{\sf message}}
\newcommand{\Agent}{{\sf Agent}}

\newcommand{\kexp}{{\it exp}}

\newcommand{\kme}{{\it me}}
\newcommand{\kparent}{{\it parent}}

\newcommand{\List}[3]{\mbox{\rm {\sf List}$_{#1}^{#2}${\sf [}${#3}${\sf ]}}}
\newcommand{\Set}[3]{\mbox{\rm {\sf Set}$_{#1}^{#2}${\sf [}${#3}${\sf ]}}}
\newcommand{\Bag}[3]{\mbox{\rm {\sf Bag}$_{#1}^{#2}${\sf [}${#3}${\sf ]}}}
\newcommand{\Map}[5]{\mbox{\rm {\sf Map}$_{#1}^{#2}${\sf [}${#4}\,\,{#3}\,{#5}${\sf ]}}}


%\newcommand{\rrangle}{\mbox{$|\hspace*{-.5ex}\rangle$}}
%\newcommand{\llangle}{\mbox{$\langle\hspace*{-.5ex}|$}}

%\newcommand{\kprefix}[2]{\llparenthesis{#2}\rrangle_{#1}}
%\newcommand{\ksuffix}[2]{\llangle{#2}\rrparenthesis_{#1}}
%\newcommand{\kmiddle}[2]{\llangle{#2}\rrangle_{#1}}
%\newcommand{\kall}[2]{\llparenthesis{#2}\rrparenthesis_{#1}}

\newcommand{\kprefix}[2]{\mprefix{}{#1}{#2}}
%\newcommand{\kprefix}[2]{\langle{#2}\ \ \_\rangle_{\sf #1}}
\newcommand{\ksuffix}[2]{\msuffix{}{#1}{#2}}
%\newcommand{\ksuffix}[2]{\langle\_\ \ {#2}\rangle_{\sf #1}}
\newcommand{\kmiddle}[2]{\mmiddle{}{#1}{#2}}
%\newcommand{\kmiddle}[2]{\langle\_ \ \ {#2}\ \ \_\rangle_{\sf #1}}
\newcommand{\kall}[2]{\mall{}{#1}{#2}}
%\newcommand{\kall}[2]{\langle{#2}\rangle_{\sf #1}}
\newcommand{\kallLarge}[2]{\left\langle\begin{array}{c}#2\end{array}\right\rangle_{{\sf #1}}}
  
  \newcommand{\kwhere}{\textrm{ when }}

%\newcommand{\kprefix}[1]{({#1}\rangle}
%\newcommand{\ksuffix}[1]{\langle{#1})}
%\newcommand{\kmiddle}[1]{\langle{#1}\rangle}

\newcommand{\reduce}[2]{\begin{array}[t]{@{\extracolsep{0ex}}c@{\extracolsep{0ex}}}{#1}\\\hline{#2}\end{array}}
\newcommand{\ereduce}[2]{\begin{array}[t]{@{\extracolsep{0ex}}c@{\extracolsep{0ex}}}{#1}\\\hdashline[1pt/1pt]{#2}\end{array}}
\newcommand{\kreduce}[2]{\begin{array}[t]{@{\extracolsep{0ex}}c@{\extracolsep{0ex}}}{#1}\\\hline{#2}\end{array}}
\newcommand{\nreduce}[2]{\framebox{$\kreduce{#1}{#2}$}}
\newcommand{\rlh}{\rightleftharpoons}
\newcommand{\Kcirc}{K^\circ}
\newcommand{\KRest}{{\it rest}}

\newcommand{\rkra}{\frame{$\curvearrowright$}\,}
\newcommand{\rfreezer}[1]{\frame{${#1}$}}
\newcommand{\rcomma}{\frame{,}\,}

\newcommand{\Decl}{{\it Decl}}
\newcommand{\VarDecl}{{\it VarDecl}}
\newcommand{\FunDecl}{{\it FunDecl}}
\newcommand{\Name}{{\it Name}}
\newcommand{\Sread}{{\sf read}}
\newcommand{\Swrite}{{\sf write}}
\newcommand{\Sfi}{{\sf fi}}
\newcommand{\Sdo}{{\sf do}}
\newcommand{\Sfor}{{\sf for}}
\newcommand{\Sto}{{\sf to}}
\newcommand{\Svar}{{\sf var}}
\newcommand{\Sfunction}{{\sf function}}
\newcommand{\Svoid}{{\sf void}}
\newcommand{\Smain}{{\sf main}}
\newcommand{\Scall}{{\sf call}}

\newcommand{\Screate}{{\sf new-agent}}
\newcommand{\Ssend}{{\sf send-asynch}}
\newcommand{\Ssendsynch}{{\sf send-synch}}
\newcommand{\Sreceivefrom}{{\sf receive-from}}
\newcommand{\Sreceive}{{\sf receive}}
\newcommand{\Sme}{{\sf me}}
\newcommand{\Sparent}{{\sf parent}}

\newcommand{\quotient}{{\it quotient}}
\newcommand{\remainder}{{\it remainder}}

\newcommand{\Sfix}{{\sf fix}}

\newcommand{\hdotline}{\hdashline[1pt/3pt]}
\newcommand{\boolval}{{\it bool}}
\newcommand{\Result}{{\it Result}}
\newcommand{\myindent}{}
\newcommand{\mysame}{\mbox{ -- same --}}

\newcommand{\ral}[1]{\stackrel{#1}{\ra}}
\newcommand{\sos}[2]{\begin{array}[t]{c}{#1}\\\hline{#2}\end{array}}
\newcommand{\SOS}{{\it SOS}}
\newcommand{\Defs}{{\it Defs}}
\newcommand{\defs}{{\it defs}}
\newcommand{\fix}{{\sf fix}_i(\vec{x}=\vec{p})}
\newcommand{\fixo}{\vec{{\sf fix}}_i(\vec{x}=\vec{p})}

\newcommand{\Iquote}{{\it quote}}

\newcommand{\PFun}{{\it PFun}}
\newcommand{\sPFun}{{\it PFun}}
\newcommand{\FunEnv}{{\it FunEnv}}
\newcommand{\FunStack}{{\it FStack}}
\newcommand{\fstack}{{\it fstack}}
\newcommand{\genv}{{\it genv}}
\newcommand{\krun}{{\it run}}
\newcommand{\kin}{{\it in}}
\newcommand{\kout}{{\it out}}
\newcommand{\loc}{{\it loc}}
\newcommand{\bindTo}{{\it bindTo}}
\newcommand{\bind}{{\it bind}}
\newcommand{\bindto}[2]{\mathrel{\it bind}{#1}\mathrel{\it to}{#2}}
\newcommand{\checkEqualToAndKeep}[1]{\mathrel{\it checkEqualTo}{#1} \mathrel{\it andKeep}}
\newcommand{\checkEqualToAndDiscard}[1]{\mathrel{\it checkEqualTo}{#1}\mathrel{\it andDiscard}}

\newcommand{\ktype}{{\it type}}
\newcommand{\tenv}{{\it tenv}}
\newcommand{\TEnv}{{\it TEnv}}
\newcommand{\gtenv}{{\it gtenv}}
\newcommand{\return}{{\it return}}
\newcommand{\toType}{{\it toType}}
\newcommand{\frozen}{{\it frozen}}
\newcommand{\unfreeze}{{\it unfreeze}}

\newcommand{\decl}{{\it decl}}
\newcommand{\fundecl}{{\it fundecl}}
\newcommand{\TBase}{{\it BaseType}}

\newcommand{\NeList}{{\it NeList}}
\newcommand{\el}{{\it el}}
\newcommand{\fd}{{\it fd}}

\newcommand{\Btrue}{{\it true}}
\newcommand{\Bfalse}{{\it false}}
\newcommand{\Bnot}{\mathop{{\it not}}}

\newcommand{\Sempty}{\emptyset}
\newcommand{\Sand}{\terminal{and}}
\newcommand{\Sor}{\terminal{or}}
\newcommand{\Snot}{\terminal{not}}
\newcommand{\Squo}{\terminal{quo}}
\newcommand{\Sskip}{\terminal{skip}}
\newcommand{\Sif}{\terminal{if}}
\newcommand{\Shalt}{\terminal{halt}}
\newcommand{\Sthen}{\terminal{then}}
\newcommand{\Selse}{\terminal{else}}
\newcommand{\Strue}{\terminal{true}}
\newcommand{\Sfalse}{\terminal{false}}
\newcommand{\Swhile}{\terminal{while}}

\newcommand{\R}{\mathcal{R}}
\newcommand{\E}{\mathcal{E}}

\newcommand{\Snew}{{\sf new}}
\newcommand{\Sself}{{\sf self}}
\newcommand{\Ssuper}{{\sf super}}
\newcommand{\Smethod}{{\sf method}}
\newcommand{\SinstanceOf}{{\sf instanceOf}}
\newcommand{\Sclass}{{\sf class}}
\newcommand{\Sextends}{{\sf extends}}
\newcommand{\Sobject}{{\sf object}}
\newcommand{\MethodDecl}{{\it MethDecl}}
\newcommand{\ClassDecl}{{\it ClsDecl}}
\newcommand{\Object}{{\it Object}}
\newcommand{\Stack}{{\it Stack}}
\newcommand{\stack}{{\it stack}}
\newcommand{\obj}{{\it obj}}
\newcommand{\class}{{\it class}}
\newcommand{\classes}{{\it classes}}
\newcommand{\getLoc}{{\it getLoc}}
\newcommand{\create}{{\it create}}
\newcommand{\addOEnvLayer}{{\it addOEnvLayer}}
\newcommand{\invoke}{{\it invoke}}

\newcommand{\CCS}{\textrm{CCS}}
\newcommand{\W}{\ensuremath{\mathscr{W}}}
\newcommand{\EXP}{\textrm{EXP}}
\newcommand{\CellLabel}{{\it CellLabel}}
\newcommand{\CellName}{{\it CellName}}

\newcommand{\CXT}{\Gamma}
\newcommand{\Syntax}{{\it Syntax}}
\newcommand{\Context}{{\it Context}}
\newcommand{\syncxt}{{\it split}}
\newcommand{\cxtsyn}{{\it plug}}
\newcommand{\rlif}{\texttt{ if }}

\newcommand{\tvar}{{\it tvar}}
\newcommand{\tvars}{{\it tvars}}
\newcommand{\typera}{\shortrightarrow}

\newcommand{\kparCCS}{\talloblong}
\newcommand{\kplusCCS}{\oplus}
\newcommand{\CCSdef}{{\it Def}}
\newcommand{\Proc}{{\it P}}
\newcommand{\Action}{{\it A}}
\newcommand{\Label}{{\it L}}
\newcommand{\Channel}{{\it Ch}}
\newcommand{\Summation}{{\it M}}

\newcommand{\crew}{\Rrightarrow}
\newcommand{\prew}[2]{\stackrel{{#1}|{#2}}{\rightrightarrows}}
\newcommand{\cstep}[3]{{#1}[{#2}\mid{#3}]}
\newcommand{\myfrac}[2]{{\displaystyle\frac{#1}{#2}}}

\newcommand{\terminalf}[1]{\ensuremath{\mathop{\texttt{#1}}}}
\newcommand{\terminalb}[1]{\ensuremath{\mathbin{\texttt{#1}}}}
\newcommand{\terminalr}[1]{\ensuremath{\mathrel{\texttt{#1}}}}
\newcommand{\terminal}[1]{\mathrel{\texttt{#1}}}
\newcommand{\somespace}{\mathbin{}}


\newcommand{\defBy}{&::=&}
\newcommand{\pOr}{\mid}
\newcommand{\pLine}{\\ &&}



\newcommand{\tworules}[2]{%
  \par  \begin{minipage}[t]{.40\textwidth}%
    #1
  \end{minipage} \hfill
  \begin{minipage}[t]{.40\textwidth}%
      #2
\end{minipage}%
}

\newcommand{\mrule}[1]{
\arule{%
\left(\begin{array}{c}#1\end{array}\right)
}%
}

\newcommand{\arule}[1]{%
\begin{quote}%
  $#1$%
\end{quote}%
}

\newcommand{\crule}[2]{%
\begin{quote}%
  $#1$%
  \begin{flushright}$\kwhere #2$%
  \end{flushright}%
\end{quote}%
}

\newcommand{\kra}{\curvearrowright}
\newcommand{\kkra}{\ \ \kra\ \ }



\newcommand{\MaudeSection}{$\largestar$\ }

\newcommand{\bgrl}[3]{\langle {#1},{#2} \rangle \ra \langle {#3} \rangle}
%\newcommand{\sigmaup}{\mbox{\Large{$\sigma$}}}

\newcommand{\logicrule}[2]{\begin{array}{@{}c@{}}{#1}\\\hline{#2}\vspace*{1ex}\end{array}}

\newcommand{\idea}[1]{\begin{center} \parbox{\textwidth}{
  \noindent \rule{\textwidth}{1pt} \vspace{-.30in}
  \begin{quote} \noindent {\it {#1}} \end{quote}
  \vspace{-.2in} \noindent \rule{\textwidth}{1pt}} \end{center}}
%\newcommand{\idea}[1]{\todo{#1}}

\definecolor{Grey}{rgb}{0.8,0.8,0.8}
\newcommand{\myinvisiblecomment}[1]{}

\newcommand{\centered}[2]{\begin{center}\begin{minipage}{#1\columnwidth}#2\end{minipage}\end{center}}

\newcommand{\kleft}{{\it left}}
\newcommand{\kright}{{\it right}}
\newcommand{\kcell}{{\it cell}}
\newcommand{\ktcell}[2]{\langle #2 \rangle_{{\sf #1}}\ }

\newcommand{\KRAM}{\textsc{Kram}}


%%%%%%%%%%%%%%%
\newcommand{\Kcell}[5]{
\newbox\labelbox
\setbox\labelbox\hbox{\ \ \ #2\ }
\begin{tabular}{@{}c@{}}
\vtop{
\vskip-1ex
\hbox{
\begin{tikzpicture}
  \node[draw=#1!50!black,line width=1pt,name=cell,shape=rounded rectangle,/pgf/rounded rectangle arc length=90,/pgf/rounded rectangle east arc=#5,/pgf/rounded rectangle west arc=#4,fill=#1!20,minimum width=\the\wd\labelbox]{$\begin{array}{@{}c@{}}#3\end{array}$};
\draw[shift=(cell.north west)]plot coordinates{(0,-.5pt)}
node[name=label,inner sep=0pt,anchor=south west,shape=rounded rectangle,/pgf/rounded rectangle arc length=180,/pgf/rounded rectangle east arc=convex,/pgf/rounded rectangle west arc=convex,fill=#1!20,draw=#1!20,line width=1pt,minimum width=2em,minimum height=2.5ex,draw=#1!50!black]
{#2};%
\draw[color=#1!20,line width=3pt](label.south east)--(label.south west);
\ifthenelse{\equal{#4}{none}}{%
\draw[fill,color=#1!50!black,decorate,decoration={coil,aspect=0,segment length=.5ex,amplitude=1pt}](cell.south west)--(cell.north west);%
}{
}
\ifthenelse{\equal{#5}{none}}{%
\draw[fill,color=#1!50!black,decorate,decoration={coil,aspect=0,segment length=.5ex,amplitude=1pt}](cell.north east)--(cell.south east);%
}{
}
\end{tikzpicture}%
}
}
\end{tabular}
}

\newcommand{\Kall}[3]{\Kcell{#1}{\sf{#2}}{#3}{convex}{convex}}
\newcommand{\Kprefix}[3]{\Kcell{#1}{#2}{#3}{convex}{none}}
\newcommand{\Ksuffix}[3]{\Kcell{#1}{#2}{#3}{none}{convex}}
\newcommand{\Kmiddle}[3]{\Kcell{#1}{#2}{#3}{none}{none}}
\newcommand{\kLarge}[1]{\left(\begin{array}{@{}c@{}}#1\end{array}\right)}
\newcommand{\kBR}{\\}

\newcommand{\mixfixSep}[1]{\,}
\newcommand{\sort}[1]{{\it #1}}


%%%%%%%%%%%%%%%

\newcommand{\QAcell}[3]{
\newbox\labelbox
\setbox\labelbox\hbox{\ \ \ #2\ }
\begin{tabular}{@{}c@{}}
\vtop{
\vskip-1ex
\hbox{
\begin{tikzpicture}
\node[draw=#1!50!black,line width=1pt,name=cell,shape=rectangle,rounded corners=7ex,fill=#1!20,minimum width=\the\wd\labelbox]{$\begin{array}{@{}c@{\ \ \ \ \ \ }}#3\end{array}$};
\draw[shift=(cell.north west)]plot coordinates{(7ex,-.5pt)}
node[name=label,inner sep=0pt,anchor=south west,shape=rounded rectangle,/pgf/rounded rectangle arc length=180,/pgf/rounded rectangle east arc=convex,/pgf/rounded rectangle west arc=convex,fill=#1!20,draw=#1!20,line width=1pt,minimum width=2em,minimum height=2.5ex,draw=#1!50!black]
{#2};%
\draw[color=#1!20,line width=3pt](label.south east)--(label.south west);
\end{tikzpicture}%
}
}
\end{tabular}
}

\newcommand{\QA}[1]{
\begin{center}
\hspace*{-5ex}
\QAcell{white}{\bf Q/A}{\parbox{.95\textwidth}{
\begin{quote}
{#1}
\end{quote}
}}
\end{center}
}


\newcommand{\Motivation}[1]{
\begin{center}
\hspace*{-5ex}
\QAcell{white}{\bf Motivation}{\parbox{1.1\textwidth}{
\begin{quote}
{#1}
\end{quote}
}}
\end{center}
}


\newcommand{\MotivationOld}[1]{
\begin{quote}
  \em #1
\end{quote}}


%%%%%%%%%%%%%%%



\DefineVerbatimEnvironment
  {maude}{Verbatim}
  {fontfamily=courier,fontseries=b,fontsize=\footnotesize}


\newcommand{\X}{\mathcal{X}}
\newcommand{\Y}{\mathcal{Y}}
\newcommand{\Z}{\mathcal{Z}}
\newcommand{\Vf}{\Lambda} 
\newcommand{\Cf}{\pi}
\newcommand{\D}{\Delta} 
\newcommand{\termAlg}[1]{T_{#1}}
\newcommand{\Cxt}[3]{{\it Cxt}_{#1}(#2,#3)}
\newcommand{\op}{f}
\newcommand{\Hole}{\square}
\newcommand{\rrho}{\varrho}
\newcommand{\krho}{\rho}
\renewcommand{\L}{L}
\newcommand{\AnyVar}{{\raisebox{1pt}{\bf\,---\,}}}

\newcommand{\RK}{{\it R2K}}
\newcommand{\KR}{{\it K2R}}

\newcommand{\krule}[3]{(\forall #1)\; #2[\ #3\ ]}
\newcommand{\green}[1]{\,\fbox{$\evenspace{white}#1\,$}\,}
%{\colorbox{green!50}{$\evenspace{green!10}\mathbf{#1}$}}
\newcommand{\red}[1]{\,\underline{\evenspace{white}#1}\,}
%{\colorbox{red!50}{$\evenspace{red!10}\mathit{#1}$}}
\newcommand{\black}[1]{#1}
%{\colorbox{white}{$\evenspace{white}\mathrm{#1}$}}
\setlength{\fboxsep}{0pt} 
\newcommand{\evenspace}[1]{{\color{#1}(\!\!}}
\newcommand{\linear}[1]{{\it linear}(#1)}
\newcommand{\ftimes}{\!\times\!}

\newcommand{\bigfrac}[2]{\frac{\textstyle #1}{\textstyle #2}}
\newcommand{\restrict}[2]{ {#1}\!\!\upharpoonright_{#2}}
\newcommand{\Kra}{\Rrightarrow}
\newlength{\syntaxlength}
\newcommand{\syntax}[3]{\par \ssyntax{#1}{#2}{#3}}
\newcommand{\ssyntax}[3]{$#1\mathrel{::=}{#2}$ \ifthenelse{\equal{#3}{}}{}{[#3]}}

\newcommand{\syntaxCont}[3]{\par $\setlength{\syntaxlength}{\widthof{$#1::\;$}}\hspace{\syntaxlength}\mid{#2}$ 
\ifthenelse{\equal{#3}{}}{}{[#3]}}
\newcommand{\syntaxContt}[3]{${}\mid{#2}$ 
\ifthenelse{\equal{#3}{}}{}{[#3]}}
\newcommand{\nonTerminal}[1]{{\it #1}\/}
\newcommand{\myquote}[1]{\terminal{"}#1\terminal{"}}
\newcommand{\prefixOp}{\terminal}

\newcommand{\framed}[1]{%
\begin{quote}
%\par
%\vspace{.5ex}\noindent\fbox{%
%\begin{minipage}{\textwidth}%
%\vspace{.5ex}  
#1%
%\vspace{.5ex}
%\end{minipage}}
\end{quote}
}

\newcommand{\mixfixPiece}[1]{\texttt{#1}}
\newcommand{\Stefanescu}{{\Sh}te\-f{\u a}\-nes\-cu}





\newlength{\deltay}
\setlength{\deltay}{1em}
\newlength{\deltax}
\setlength{\deltax}{1em}


\newcommand{\so}[4][]{\Vertex[position={below=\deltay of #2},L={#4},#1]{#3}}
\newcommand{\no}[4][]{\Vertex[position={above=\deltay of #2},L={#4},#1]{#3}}
\newcommand{\ea}[4][]{\Vertex[position={right=\deltay of #2},L={#4},#1]{#3}}
\newcommand{\we}[4][]{\Vertex[position={left=\deltay of #2},L={#4},#1]{#3}}
\newcommand{\soea}[4][]{\Vertex[position={below right=\deltay and \deltax of #2},L={#4},#1]{#3}}
\newcommand{\sowe}[4][]{\Vertex[position={below left=\deltay and \deltax of #2},L={#4},#1]{#3}}
\newcommand{\noea}[4][]{\Vertex[position={above right=\deltay and \deltax of=#2},L={#4},#1]{#3}}
\newcommand{\nowe}[4][]{\Vertex[position={above left=\deltay and \deltax of=#2},L={#4},#1]{#3}}
\newcommand{\edge}[4][]{\Edge[label={#4},#1](#2)(#3)}

\newcommand{\suc}[6][]{
\ifthenelse{\equal{#3/#6}{1/1}\or\equal{#3/#6}{2/3}}{%
  \so[#1]{#2}{#2#30}{#5}%
  \Edge[label={\scriptsize #3},labelstyle={above right=-1pt and 1pt,midway,inner sep=0pt,minimum size=0pt},#1](#2)(#2#30)
  }{\ifthenelse{\equal{#3/#6}{1/2}\or\equal{#3/#6}{1/3}}{%
    \sowe[#1]{#2}{#2#30}{#5}%
  \Edge[label={\scriptsize #3},#1](#2)(#2#30)
  }{\ifthenelse{\equal{#3/#6}{2/2}\or\equal{#3/#6}{3/3}}{%
  \soea[#1]{#2}{#2#30}{#5}%
  \Edge[label={\scriptsize #3},#1](#2)(#2#30)
  }{\so[#1]{#2}{#2#30}{update succ macro}
}
}
}
  \so[#1]{#2#30}{#2#3}{#4}
  \Edge[#1](#2#30)(#2#3)
}

\newcommand{\var}[6][]{
\ifthenelse{\equal{#3/#6}{1/1}\or\equal{#3/#6}{2/3}}{%
  \so[#1]{#2}{#4}{$#4$:#5}%
  \Edge[label={\scriptsize #3},labelstyle={above right=-1pt and 1pt,midway,inner sep=0pt,minimum size=0pt},#1](#2)(#4)
  }{\ifthenelse{\equal{#3/#6}{1/2}\or\equal{#3/#6}{1/3}}{%
    \sowe[#1]{#2}{#4}{$#4$:#5}%
\Edge[label={\scriptsize #3},#1](#2)(#4)
  }{\ifthenelse{\equal{#3/#6}{2/2}\or\equal{#3/#6}{3/3}}{%
  \soea[#1]{#2}{#4}{$#4$:#5}%
\Edge[label={\scriptsize #3},#1](#2)(#4)
  }{\so[#1]{#2}{#4}{update var macro}
}
}
}
}

\newcommand{\fir}[3][]{
  \Vertex[L={#3},#1]{e0}
  \so[#1]{e0}{e}{#2}
  \Edge[#1](e0)(e)
}

\newcommand{\graph}[1]{

\begin{tikzpicture}
\pgfsetarrowsstart{latex} 
  \GraphInit[vstyle=Normal]
 \SetUpEdge[lw         = .5pt,
            style={-latex'},
%            color      = orange,
%            labelcolor = red!30,
            labelstyle = {above=2pt,midway,inner sep=0pt,minimum size=0pt}
            ]
  \tikzset{VertexStyle/.style={draw=none,inner sep=.5pt,minimum size=0pt}}
%  \tikzset{EdgeStyle/.style={-latex}}
  #1
\end{tikzpicture}
}

%\newenvironment{module}[1]{\begin{quote}\noindent\textsc{Module #1}\setlength{\parindent}{1em}}{\par\noindent\textsc{end module}\end{quote}}

\newcommand{\kcrule}[3]{\Large command \verb"\kcrule" is undefined}
%\renewenvironment{module}[1]{\begin{quote}\noindent\textsc{Module #1}\setlength{\parindent}{1em}}{\par\noindent\textsc{end module}\end{quote}}
\newlength{\oldparindent}
\setlength{\oldparindent}{\parindent}
 \newenvironment{module}[1]{\bigskip%\setlength{\parindent}{1em}
\par%
\noindent%
\textsc{Module #1}\setlength{\parindent}{1em}}{%\setlength{\parindent}{1em}
\par%
\noindent%
\textsc{end module}\bigskip
\setlength{\parindent}{\oldparindent}
}

%\newenvironment{module}[1]{\par\noindent\textsc{Module #1}\setlength{\parindent}{1em}}{\par\noindent\textsc{end module}}
\newcommand{\moduleName}[1]{#1}
\newcommand{\including}[1]{\par \textsc{imports}\ #1}
\newcommand{\kincluding}[1]{ \textsc{imports}\ #1}
\newcommand{\modulePlus}{$+$}
\newcommand{\kconfig}[1]{\par\textsc{initial configuration:}\setlength{\parindent}{2em}\par$#1$\setlength{\parindent}{1em}}
\newcommand{\reduceS}[2]{\begin{array}[t]{@{\extracolsep{0ex}}c@{\extracolsep{0ex}}}{#1}\\\hdashline[1pt/1pt]{#2}\end{array}}
\newcommand{\mybracket}[1]{(#1)}
\newcommand{\reduceTop}[2]{{#1}\Rightarrow{#2}}
%\renewcommand{\reduceS}{\reduce}
\newcommand{\reduceTopS}[2]{{#1}\rightharpoonup{#2}}
\newcommand{\mall}[3]{\langle{#3}\rangle_{\sf #2}}
\newcommand{\constant}[1]{{\sf #1}}
\newcommand{\kdot}{\cdot}
\newcommand{\kComma}{\textit{\LARGE\(,\)}}
\newcommand{\kkcrule}[3]{
\par
  $#2$%
  \par\hfill$\kwhere #3$%
  
}
\newcommand{\ellipses}{\mathrel{\cdot\!\!\cdot\!\!\cdot}}
\newcommand{\mprefix}[3]{\mall{#1}{#2}{{#3}\ \ellipses}}
\newcommand{\msuffix}[3]{\mall{#1}{#2}{\ellipses\ {#3}}}
\newcommand{\mmiddle}[3]{\mall{#1}{#2}{\ellipses\ {#3}\ \ellipses}}


\newcommand{\kCell}[5]{
\begin{tabular}{@{}c@{}}
\vtop{
\vskip-1ex
\hbox{
\begin{tikzpicture}
  \node[draw=#1!50!black,line width=1pt,name=cell,shape=rounded rectangle,/pgf/rounded rectangle arc length=180,/pgf/rounded rectangle east arc=#5,/pgf/rounded rectangle west arc=#4,fill=#1!20,minimum height=4ex,minimum width=3em]{#3};
\draw[shift=(cell.north east)]plot coordinates{(-.1pt,-.5pt)} node[name=ce,minimum size=0pt,inner sep=0pt]{};
\draw[shift=(cell.north west)]plot coordinates{(.1pt,-.5pt)} node[name=cw,     minimum size=0pt,inner sep=0pt]{};
\draw[color=white,line width=1.2pt](cw.east)--(ce.west);
\draw[shift=(cell.north west)]plot coordinates{(0,-1.05pt)}
node[name=label,inner sep=0pt,anchor=south west,shape=rounded rectangle,/pgf/rounded rectangle arc length=180,/pgf/rounded rectangle east arc=convex,/pgf/rounded rectangle west arc=convex,fill=#1!20,draw=#1!20,line width=1pt,minimum width=2em,minimum height=2.5ex,draw=#1!50!black]
{#2};%
\draw[shift=(label.south east)]plot coordinates{(-.1pt,.5pt)} node[name=le,minimum size=0pt,inner sep=0pt]{};
\draw[shift=(label.south west)]plot coordinates{(.1pt,.5pt)} node[name=lw,     minimum size=0pt,inner sep=0pt]{};
\draw[color=white,line width=1.2pt](lw.east)--(le.west);
\draw[color=#1!50!black,line width=1pt](le.west) -- (ce.east);
\ifthenelse{\equal{#4}{none}}{%
\draw[fill,color=#1!50!black,decorate,decoration={coil,aspect=0,segment length=.5ex,amplitude=1pt}](cell.south west)--(cell.north west);%
}{
}
\ifthenelse{\equal{#5}{none}}{%
\draw[fill,color=#1!50!black,decorate,decoration={coil,aspect=0,segment length=.5ex,amplitude=1pt}](cell.north east)--(cell.south east);%
}{
}
\end{tikzpicture}%
}
\vskip2ex}
\end{tabular}
}


\newcommand{\ball}[3]{\kCell{#1}{#2}{$#3$}{convex}{convex}}
\newcommand{\ballLarge}[3]{\kCell{#1}{#2}{$\begin{array}{@{}c@{}}#3\end{array}$}{convex}{convex}}
\newcommand{\bprefix}[3]{\kCell{#1}{#2}{$#3$}{convex}{none}}
\newcommand{\bsuffix}[3]{\kCell{#1}{#2}{$#3$}{none}{convex}}
\newcommand{\bmiddle}[3]{\kCell{#1}{#2}{$#3$}{none}{none}}
\newcommand{\bdot}{{\scriptstyle\bullet}}
\newcommand{\bAnyVar}{\AnyVar}


\newcommand{\variable}[1]{{\it #1}\/}
\newcommand{\nothing}{}
\newcommand{\subscript}[1]{\ensuremath{\nothing_{#1}}}
\newcommand{\sorts}[1]{}
\newcommand{\rkrule}[2]{
\par\indent\textsc{#1:}\hspace{1em}
\skrule{#1}{#2}%\bigskip
}
\newcommand{\kkrule}[2]{
\par%\indent\textsc{#1 rule:}\hspace{1em}
\skrule{#1}{#2}%\bigskip
}
\newcommand{\skrule}[2]{
$#2$%\bigskip
}
\newcommand{\kkruleLarge}[2]{
\par%\indent\textsc{#1 rule:}\hspace{1em}
$\left(\begin{array}{c}#2\end{array}\right)$%\bigskip
}
\newcommand{\Left}{L}
\newcommand{\Right}{R}

\newcommand{\lV}{{\rm lv}}
\newcommand{\lE}{{\rm le}}
\newcommand{\Labels}{{\cal L}}
\newcommand{\source}{{\rm source}}
\newcommand{\target}{{\rm target}}

\newcommand{\kequation}[2]{
\par%\textsc{#1 rule:}\hspace{1em}
\skequation{#1}{#2}
}
\newcommand{\skequation}[2]{
$#2$%\bigskip
}
\newcommand{\Graph}{\ensuremath{\bf Graph}}
\newcommand{\reachable}[2]{ {#2}\!\!\upharpoonright_{#1}}
\newcommand{\TGraph}[1]{\ensuremath{\bf KGraph}_{#1}}
\newcommand{\tgraph}{{\it graph}}
\newcommand{\term}{{\it term}}
\newcommand{\subterm}{{\it subterm}}


\def\Rrelbar{\raise.093ex\hbox{$\scriptstyle\equiv$}}
\def\Rrah{\hspace{.1em}\succ}
\def\karrowfill@{\arrowfill@\Rrelbar\Rrelbar\Rrah} 
\newcommand{\karrow}[2][]{\ext@arrow 0000\karrowfill@{#1}{#2}} 

\newcommand{\skarrow}[1]{\stackrel{#1}{\raise.093ex\hbox{$\scriptstyle\equiv$}\hspace{-.2em}{\succ}}}

\newcommand{\indegree}[2][]{{\it indegree}_{#1}(#2)}
\newcommand{\outdegree}[2][]{{\it outdegree}_{#1}(#2)}
\newcommand{\VAR}[1]{VAR_{#1}}
\newcommand{\ROOT}[1]{{\it root}_{#1}}
\newcommand{\ROOTS}[1]{{ROOT}_{#1}}
\newcommand{\LEFT}{{\it left}}
\newcommand{\RIGHT}{{\it right}}
\newcommand{\TVars}[1]{TVARS_{#1}}
\newcommand{\Open}[1]{OPEN_{#1}}
\newcommand{\arity}{{\it arity}}
\newcommand{\KG}{{\it K2G}}
\newcommand{\topSort}[1]{{\it sort}(#1)}
\newcommand{\topSym}[1]{{\it symbol}(#1)}
\newcommand{\terminalNoSpace}[1]{\mathord{\texttt{#1}}}
\newcommand{\kcontext}[2]{\par\textsc{context:
}$#2$}
\newcommand{\mequation}[3]{\par\textsc{#1 macro:}\hspace{1em}$#2 = #3$}
\newcommand{\mallLarge}[3]{\left\langle\begin{array}{@{}c@{}}#3\end{array}\right\rangle_{{\sf #2}}}


\lstnewenvironment{asciik}{
       \lstset{
               language=k,
               basicstyle=\small,
               tabsize=2,
               %frame=tb,
               columns=flexible,
               mathescape=true,
               emph={env, store, T, k, nextLoc, thread, threads, thread*, out, in, race, raceDetected, mem, next, id},
               emphstyle={\textsf},
               emph={[2]not, and, var, vars, if, then, else, while, do, spawn, rv, print, false, true, haltThread, acquire, release},
               emphstyle={[2]\texttt},
               emph={[3]Map, Set, Bag, List, K, KLabel, KResult, KProper, CellLabel, SetItem, BagItem, ListItem, MapItem, AExp, BExp, Int, Bool, Stmt, Id, Exp},
               emphstyle={[3]\textit}
       }
}{}


\lstnewenvironment{asciic}{
       \lstset{
               language=C,
               basicstyle=\small,
               tabsize=2,
               %frame=tb,
               columns=flexible,
%               mathescape=true,
               emph={spawn, acquire, release, join},
               emphstyle={\textbf}
       }
}{}

\newcommand{\Knil}{\cdot}
\lstdefinelanguage{k}{
       morekeywords={configuration, kmod, mod, endm, endkm, including, is, eq, rule, macro, op, ops, syntax, sort, sorts, subsort, subsorts, context, hybrid, strict, seqstrict, color, latex, kvar, structural, search, rewrite},
       literate=
       {LT}{$<$}3
       {LEQ}{$<=$}4 
       {+Int}{$+_{\rm\scriptstyle Int}$}4 
       {*Int}{$*_{\rm\scriptstyle Int}$}4 
       {/Int}{$/_{\rm\scriptstyle Int}$}4 
       {LeqInt}{$<=_{\rm\scriptstyle Int}$}6 
       {!=Int}{$!=_{\rm\scriptstyle Int}$}5 
       {==Bool}{$==_{\rm\scriptstyle Bool}$}7 
       {notBool}{${\tt not}_{\rm\scriptstyle Bool}$}5 
       {<}{$\langle$}1 
       {>}{$\rangle$}1 
       {_}{$\_$}1 {~}{$\_$}1 
       {=>}{$\Rightarrow$}3 
       {->}{{$\rightarrow$}}3 
       {~>}{{$\kra$}}3  
       {|->}{$\mapsto$}2 
}
\newcommand{\ka}[1]{\mbox{\lstinline[language=k]{#1}}}


\newcommand{\by}[2]{`#1' by `#2'}
\newcommand{\kcequation}[3]{
\par%\textsc{#1 rule:}\hspace{1em}
$#2$ \hspace{1em} when $#3$%\bigskip
}

\newcommand{\sqbracket}[1]{[#1]}

%\newcommand{\krule}{\kkrule}
%\newcommand{\kcrule}{\kkcrule}
%\newcommand{\kall}{\mall}
%\newcommand{\kallLarge}{\mallLarge}
%\newcommand{\kprefix}{\mprefix}
%\newcommand{\kmiddle}{\mmiddle}
%\newcommand{\ksuffix}{\msuffix}

